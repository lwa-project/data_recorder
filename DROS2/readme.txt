// ========================= DROSv2 License preamble===========================
// Software for DROSv2 is covered jointly under GPLv3 and Boost 1.0 licenses,
// to the extent required by included Boost sources and GPL sources, and to the
// more restrictive case pertaining thereunto, as defined herebelow. Beyond those
// requirements, any code not explicitly restricted by either of thowse two license
// models shall be deemed to be licensed under the GPLv3 license and subject to
// those restrictions.
//
// Copyright 2012, Virginia Tech, University of New Mexico, and Christopher Wolfe
//
// ========================= Boost License ====================================
// Boost Software License - Version 1.0 - August 17th, 2003
//
// Permission is hereby granted, free of charge, to any person or organization
// obtaining a copy of the software and accompanying documentation covered by
// this license (the "Software") to use, reproduce, display, distribute,
// execute, and transmit the Software, and to prepare derivative works of the
// Software, and to permit third-parties to whom the Software is furnished to
// do so, all subject to the following:
//
// The copyright notices in the Software and this entire statement, including
// the above license grant, this restriction and the following disclaimer,
// must be included in all copies of the Software, in whole or in part, and
// all derivative works of the Software, unless such copies or derivative
// works are solely in the form of machine-executable object code generated by
// a source language processor.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
// SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
// FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
// ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
// DEALINGS IN THE SOFTWARE.
//
// =============================== GPL V3 ====================================
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.


Software: MCS-DR Operating Software
Author:    C.N. Wolfe
Version:  DROS-2.0-Devel-27740
Date:     

Introduction
============

 This archive contains the MCS-DR Operating Software (DROSv2 or DROSv2, or DROSv2). DROSv2 is 
 designed to accept commands from MCS to record and later retrieve data provided by DP. In this 
 tarball exists all of the souce for the executable, as well as make files needed to build it. 
 
 The application is developed in C and C++. The code is not portable and relies on G++ provided
 access to Intel SSE instructions. The application is developed under Eclipse (Juno), and this 
 archive includes the .project and .cproject files required to import the project back into eclipse. 
 
 DROSv2 is designed exclusively for 64-bit linux architectures, and will not compile for 32-bit 
 targets. This design is targeted for Ubuntu Linux 12.04 x86_64, Desktop, and no other targets
 have been tested. Although the software should build for any 64-bit linux target, this is 
 not guaranteed. 
 
 DROSv2 requires several libraries installed to build: libfftw3-dev, libboost-all-dev. 
 Building this application using the tarball makefile with the "deps" target will download 
 and install the prerequisites.
 
 The DROSv2 contained in this tarball is not the same as the code used to test & verify in 
 LWA memo 165. This software differs in that a good portion of the ICD has been implemented 
 on top of the existing data and message processing mechanisms. Further, the software has 
 been cleaned to remove portions only useful in testing and development.



Limitations
===========
 DROSv2 is currently under development, and the version provided here is 'beta'. Remaining tasks 
 are mostly cosmetic. Version DROS-2.0-Devel-27740 is ready with the following exceptions:
  <<none>>
 
 
Build instructions
==================
  The DROSv2 executable may be built by untarring, entering the Release folder, and issuing make:
    tar -xvf ./>>>ARCHIVE-NAME<<<.tar.gz 
    cd DROS2/Debug/
    touch ../*
    make
  The DROSv2 executable may be also be built by untarring, importing the project into Eclipse (Ganymede),
  and choosing "Build Project" from eclipse's menu system.
  
Usage Instructions
==================
    For detailed usage instructions, please see ExtendedUsersGuide.txt in the DROS-2.0-Devel-27740 tarball.
    
    Minimally, extract and build the tarball, and start the DROSv2 software by:
    >sudo /LWA/bin/DROS2

    The following will be displayed:
      ========================== Logfile rotated ==========================
      ========================== Logfile opened ==========================
      FATAL: Error inserting f71882fg (/lib/modules/3.2.0-30-generic/kernel/drivers/hwmon/f71882fg.ko): No such device
      2012-11-09 23:09:24.415 [I] message originating in      ../System/System.cpp:134
                  [I] [System          ] ======================= Active Thread Report =======================
                  [I] [System          ] [   0]: tid = 13279
                  [I] [System          ] ===================== End Active Thread Report =====================
      2012-11-09 23:09:24.416 [I] [System          ] [System] Booting Start
      2012-11-09 23:09:24.416 [I] [System          ] [System] Hardware CPU count: 8
      2012-11-09 23:09:24.416 [I] [System          ] [System] Read config...
      2012-11-09 23:09:24.416 [I] [System          ] Configuration data loaded...
      2012-11-09 23:09:24.416 [D] message originating in      ../System/Config.cpp:98
                  [D] [System          ] MyReferenceDesignator         DR1
                  [D] [System          ] SelfIp                        192.168.1.20
                  [D] [System          ] MessageInPort                 5000
                  [D] [System          ] MessageOutPort                5001
                  [D] [System          ] TimeAuthority                 Time.Ubuntu.com
                  [D] [System          ] SerialNumber                  0
                  [D] [System          ] ArraySelect                   1
                  [D] [System          ] DataInPort                    16180
      2012-11-09 23:09:24.417 [I] [System          ] [System] Scan storage devices...
      2012-11-09 23:09:24.417 [I] [System          ] Beginning storage subsystem initialization.

    < will pause here for a few minutes >
    <additional output not shown, will vary by DRSU content>
      2012-11-09 23:10:23.539 [D] [System          ] RESOLVE BY INDEX
      2012-11-09 23:10:23.539 [D] [System          ] RESOLVED TO 0
      2012-11-09 23:10:23.540 [I] [System          ] [System] Initialize scheduler...
      2012-11-09 23:10:23.540 [I] [System          ] [System] Initialize receive buffer...
      2012-11-09 23:10:23.540 [I] [Schedule        ] [GenericThread] : Set CPU affinity : '0'
      2012-11-09 23:10:23.540 [I] [Schedule        ] [GenericThread] : Set priority : '-1'
      2012-11-09 23:10:23.540 [I] [Schedule        ] [Schedule] started scheduler.
      2012-11-09 23:10:23.540 [I] [System          ] [System] Initialize receiver...
      2012-11-09 23:10:23.540 [I] [System          ] [System] Wait for receiver to start...
      2012-11-09 23:10:23.572 [I] [Receiver        ] [GenericThread] : Set CPU affinity : '1'
      2012-11-09 23:10:23.573 [I] [Receiver        ] [GenericThread] : Set priority : '-2'
      2012-11-09 23:10:23.573 [I] [Receiver        ] [Receiver] initializing ...
      2012-11-09 23:10:23.573 [D] [Receiver        ] [TicketBuffer:MasterReceiveBuffer] Resizing to 1.00000 GiB with 4.03125 KiB frames and 1016 frames/ticket
      2012-11-09 23:10:23.574 [D] [Receiver        ] [TicketBuffer:MasterReceiveBuffer] Destroyed 0 old tickets
      2012-11-09 23:10:23.574 [D] [Receiver        ] [TicketBuffer:MasterReceiveBuffer] Created 256 new tickets
      2012-11-09 23:10:23.587 [D] [Receiver        ] [TicketBuffer:MasterReceiveBuffer] Resizing complete 
      2012-11-09 23:10:23.588 [I] [Receiver        ] [Receiver] opened data socket on port 16180
      Socket opened on port 16180.
      2012-11-09 23:10:23.588 [I] [System          ] [System] Start messaging responder...
      2012-11-09 23:10:23.588 [I] [Receiver        ] [Receiver] Buffer usage: [________________________________________] (  0%)
      2012-11-09 23:10:23.588 [D] [System          ] WaitQueue 'ResponseSender' constructed.
      2012-11-09 23:10:23.588 [I] [Receiver        ] [Receiver] Receive rate: [________________________________________] (  0%)  0.00000 B/s  
      2012-11-09 23:10:23.588 [I] [Receiver        ] [Receiver] Subscribers 0
      2012-11-09 23:10:23.588 [D] [System          ] [WaitQueueManager] Registered queue 'ResponseSender'.
      2012-11-09 23:10:23.588 [I] [System          ] [System] Start message processor...
      2012-11-09 23:10:23.589 [D] [System          ] WaitQueue 'MessageProcessor' constructed.
      2012-11-09 23:10:23.589 [D] [System          ] [WaitQueueManager] Registered queue 'MessageProcessor'.
      2012-11-09 23:10:23.589 [I] [System          ] [System] Start message receiver...
      2012-11-09 23:10:23.589 [I] [System          ] [MessageListener] : Messaging socket opened on port5000
      2012-11-09 23:10:23.589 [I] [System          ] [System] Determining system status...
      2012-11-09 23:10:23.589 [I] [System          ] [System] system is 'NORMAL '
      2012-11-09 23:10:23.589 [I] [System          ] [System] Booting Complete

    With the last line indicating that the MCS-DR software is up and running.  
    At this point, the system is up and listening for command messages. It should periodically spit out messages indicating buffer usage: as below:
      2012-11-09 23:10:23.588 [I] [Receiver        ] [Receiver] Buffer usage: [________________________________________] (  0%)
      2012-11-09 23:10:23.588 [I] [Receiver        ] [Receiver] Receive rate: [________________________________________] (  0%)  0.00000 B/s  
      2012-11-09 23:10:23.588 [I] [Receiver        ] [Receiver] Subscribers 0

    
         
 

Additional Files required
=========================
 
 DROSv2 expects to be installed to a specific path, and expects to find additional support files 
 at specified locations. 
 
 /LWA/scripts		Contains maintenance-related scripts
 /LWA/config		Contains defaults_v2.cfg
 /LWA/bin		    Contains the DROSv2 binary "DROS2" 
 
   defaults_v2.cfg
   ===============
     This file is used to configure the DROSv2 on first boot and/or at the issuance of an INI command
     The following is a sample config file. Note that the values are those used in development,
     and not suitable for the LWA shelter network environment.
     
     /-----------------------------------------------------------------------------------------
     |    # system IP
     |    SelfIP = 192.168.1.20
     |    
     |    # system reference Identifier
     |    MyReferenceDesignator = MD1
     |    
     |    # udp port to listen for messages
     |    MessageInPort = 5001
     |    
     |    # udp port to send responses to (presumably MCS)
     |    MessageOutPort = 5000
     |    
     |    # URL to send responses to (presumably MCS)
     |    MessageOutURL = 192.168.1.20
     |    
     |    # udp port to listen for data
     |    DataInPort = 6002
     |    
     |    # ntp time server ip address or URL
     |    TimeAuthority = ntp.ubuntu.com
     |    
     |    # default DRSU selection
     |    ArraySelect = )HappyPuppy
     |    
     |    # MCS-DR serial number (currently just a place holder until devices are assigned)
     |    MySerialNumber = XPS-435-MT-(Development-Machine-0)
     \-----------------------------------------------------------------------------------------
     
  
 

File Inventory
==============
 [ out of date, reorganizing ]
    